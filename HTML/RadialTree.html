<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node {
  cursor: pointer;
}

.node circle {
  fill: #999;
  stroke: steelblue; 
  stroke-width: 1.5px;
}

.node text {
  font: 10px sans-serif;
}

.link {
  fill: #e6f5c9;
  stroke: #e6f5c9;
  //fill : "black";
  //stroke: "black";
  //stroke-width: 5.5px;
  
.ticks {
  font: 10px sans-serif;
}

.track,
.track-inset,
.track-overlay {
  stroke-linecap: round;
}

.track {
  stroke: #000;
  stroke-opacity: 0.3;
  stroke-width: 10px;
}

.track-inset {
  stroke: #ddd;
  stroke-width: 8px;
}

.track-overlay {
  pointer-events: stroke;
  stroke-width: 50px;
  cursor: crosshair;
}

.handle {
  fill: #fff;
  stroke: #000;
  stroke-opacity: 0.5;
  stroke-width: 1.25px;
} 

<!-- Clock Styling Start -->

textPath {
            font-family: "Times New Roman", Times, serif;
            font-style: normal;
            font-size: 25px;
            /*color:black;*/
            padding: 5px;
        }
         #headerTextId
        {
           font-family: "Times New Roman", Times, serif;
            font: 20px sans-serif;
            color: black;
            padding: 5px;
            font-style: normal;
            font-weight: bold;
        }
        .arc text {
            font-family: "Times New Roman", Times, serif;
            font: 15px sans-serif;
            text-anchor: middle;
            text-align: center;
            color: black;
            padding: 5px;
            font-style: normal;
            font-weight: bold;
        }

        .arc2 text {
            font-family: "Times New Roman", Times, serif;
            font: 15px sans-serif;
            text-anchor: middle;
            text-align: center;
            color: black;
            padding: 10px;
            font-style: normal;
            font-weight: bold;
            /*font: 10px sans-serif;
            text-anchor: middle;*/
        }

        /*.txt
        {
            font-family: "Times New Roman", Times, serif;
          font-style: normal;
          font-size: 20px;
          color:black;
          padding:5px;
        }*/
        .arc path {
            stroke: #fff;
        }

        .arc2 path {
            stroke: #fff;
        }

<!-- Clock Stylng End -->



</style>
<body>

<script src="//d3js.org/d3.v4.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
	<script src="clock2.js"></script>
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
    <div class="pure-menu pure-menu-horizontal" style="background-color:black;">
        <a href="#" class="pure-menu-heading pure-menu-link">CS-424</a>
        <ul class="pure-menu-list">
            <li class="pure-menu-item"></li>
            <li class="pure-menu-item"><a href="../Default1.html" class="pure-menu-link">Home</a></li>
            <li class="pure-menu-item"><a href="RadialTree.html" class="pure-menu-link">Compare Wait Times</a></li>
            <li class="pure-menu-item"><a href="../About.html" class="pure-menu-link">About</a></li>
            <li class="pure-menu-item"><a href="../Contact.html" class="pure-menu-link">Contact Us</a></li>
        </ul>
    </div>
<script>

	var duration=3000, delay = 3000;

	var width = 700, //1350
	height = 600, //960
	margin = {top:20,bottom:20,right:20,left:20};
	duration = 750;
	
	var selectedYear = "2015";

	var nodes,links;
	
	var timeOut2013,timeOut2014,timeOut2015;

	var animationButtonPress = "stop";
	
	var chosenAirports = new Array();
    
	var svg = d3.select("body").append("svg")
				.attr("width",width)
				.attr("height",height);
				
	svg.append("rect")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("fill", "white");	
	
	createButtons();
	
	// The below code creates the various buttons that are displayed on the screen for animation 
	
	function createButtons()
	{
		// Declaration of buttons for various purposes like Start Animation, Stop Animation, Collapse Node, 2013 Data, 2014 data & 2015 Data
		var btnStartAnimation, btnStopAnimation, btnCollapseAllNodes, btn2013Data, btn2014Data, btn2015Data;
	
		btnStartAnimation = d3.select('body').append('div')
                         .attr('id', 'btnStartAnimation')
                         .style('position', 'absolute')
                         .style('opacity', 1)
                         .style('background-color', 'orange').text('Start Animation')
						 .style("text-align","center")
                         .style('width', '130px')
                         .style("left", "160px")
                         .style("top", "45px")
                         .style('line-height', 1)
                         .style('font-weight', 'bold')
                         .style('padding', '3px')
                         //.style('color', '#000')
						 .style('color', 'white')
                         .style('border-radius', '2px')
                         .on("click", function () {
                             startAnimation();
                         })
						 .on("mouseover", function(d){
							d3.select(this).style("cursor","pointer");
						 })
						 .on("mouseout", function(d){
							d3.select(this).style("cursor","default");
						 });
	
		btnStopAnimation = d3.select('body').append('div')
                         .attr('id', 'btnStopAnimation')
                         .style('position', 'absolute')
                         .style('opacity', 1)
						 .style("text-align","center")
                         .style('background-color', 'orange').text('Stop Animation')
                         .style('width', '130px')
                         .style("left", "320px")
                         .style("top", "45px")
                         .style('line-height', 1)
                         .style('font-weight', 'bold')
                         .style('padding', '3px')
                         .style('color', '#fff')
                         .style('border-radius', '2px')
                         .on("click", function () {
                             stopAnimation();
                         })
						 .on("mouseover", function(d){
							d3.select(this).style("cursor","pointer");
						 })
						 .on("mouseout", function(d){
							d3.select(this).style("cursor","default");
						 });
	
		btnCollapseAllNodes = d3.select('body').append('div')
                         .attr('id', 'btnCollapseAllNodes')
                         .style('position', 'absolute')
                         .style('opacity', 0)
						 .style("text-align","center")
                         .style('background-color', 'orange').text('Collapse All Nodes')
                         .style('width', '160px')
                         .style("left", "230px")
                         .style("top", "610px")
                         .style('line-height', 1)
                         .style('font-weight', 'bold')
                         .style('padding', '3px')
                         .style('color', '#fff')
                         .style('border-radius', '2px')
                         .on("click", function () {
                             updateData();
                         })
						 .on("mouseover", function(d){
							d3.select(this).style("cursor","pointer");
						 })
						 .on("mouseout", function(d){
							d3.select(this).style("cursor","default");
						 });
						 
						 
		btn2013Data = d3.select('body').append('div')
                         .attr('id', 'btn2013Data')
                         .style('position', 'absolute')
                         .style('opacity', 1)
						 .style("text-align","center")
                         .style('background-color', 'orange').text('2013')
                         .style('width', '70px')
                         .style("left", "150px")
                         .style("top", "580px")
                         .style('line-height', 1)
                         .style('font-weight', 'bold')
                         .style('padding', '3px')
                         .style('color', '#fff')
                         .style('border-radius', '2px')
                         .on("click", function () {
                             updateData2013();
                         })
						 .on("mouseover", function(d){
							d3.select(this).style("cursor","pointer");
						 })
						 .on("mouseout", function(d){
							d3.select(this).style("cursor","default");
						 });
						 
						 
		btn2014Data = d3.select('body').append('div')
                         .attr('id', 'btn2014Data')
                         .style('position', 'absolute')
                         .style('opacity', 1)
						 .style("text-align","center")
                         .style('background-color', 'orange').text('2014')
                         .style('width', '70px')
                         .style("left", "270px")
                         .style("top", "580px")
                         .style('line-height', 1)
                         .style('font-weight', 'bold')
                         .style('padding', '3px')
                         .style('color', '#fff')
                         .style('border-radius', '2px')
                         .on("click", function () {
                             updateData2014();
                         })
						 .on("mouseover", function(d){
							d3.select(this).style("cursor","pointer");
						 })
						 .on("mouseout", function(d){
							d3.select(this).style("cursor","default");
						 });
						 
						 
		btn2015Data = d3.select('body').append('div')
                         .attr('id', 'btn2015Data')
                         .style('position', 'absolute')
                         .style('opacity', 1)
						 .style("text-align","center")
                         .style('background-color', 'orange').text('2015')
                         .style('width', '70px')
                         .style("left", "390px")
                         .style("top", "580px")
                         .style('line-height', 1)
                         .style('font-weight', 'bold')
                         .style('padding', '3px')
                         .style('color', '#fff')
                         .style('border-radius', '2px')
                         .on("click", function () {
                             updateData2015();
                         })
						 .on("mouseover", function(d){
							d3.select(this).style("cursor","pointer");
						 })
						 .on("mouseout", function(d){
							d3.select(this).style("cursor","default");
						 });
	}
	
	var g = svg.append("g")
            .attr("transform", "translate(300," + height / 2  + ")");
			
	
	// the below code creates the path betweeen the parent and child nodes
	function connector(d) {
			return "M" + project(d.x, d.y)
				 + "C" + project(d.x, (d.y + d.parent.y) / 2)
				 + " " + project(d.parent.x, (d.y + d.parent.y) / 2)
				 + " " + project(d.parent.x, d.parent.y);
	}
	
	var tree,
		root;
		
		// Clicking the stop animation button would stop the animation
		function stopAnimation()
		{
			animationButtonPress = "stop";
			
			var collapseButton = d3.select(btnCollapseAllNodes)
								   .style("opacity",0);
			var data2013 = d3.select(btn2013Data)
							 .style("opacity",1);
			var data2014 = d3.select(btn2014Data)
							 .style("opacity",1);
							 
			var data2015 = d3.select(btn2015Data)
							 .style("opacity",1);
			
			//initialFunction();
			clearTimeout(timeOut2013);
			clearTimeout(timeOut2014);
			clearTimeout(timeOut2015);
			
		}
		
		// Clicking the start animation starts the animation for loading data corresponding to each year
		function startAnimation()
		{
			animationButtonPress = "start";
			
			var collapseButton = d3.select(btnCollapseAllNodes)
								   .style("opacity",0);
			var data2013 = d3.select(btn2013Data)
							 .style("opacity",0);
			var data2014 = d3.select(btn2014Data)
							 .style("opacity",0);
							 
			var data2015 = d3.select(btn2015Data)
							 .style("opacity", 0);
			
			
			updateData2015(); // By default, data for the year 2015 is displayed
			
			
			
		}
	var i =0;
	var nodeSvg, linkSvg, nodeEnter, linkEnter;
	
	initialFunction();
	function initialFunction()
	{
	//i = 0;
		tree = d3.tree()
		.size([360,0]);
		//.size([150,50]),
		//.size([150,100]);
	
	/* This function keeps all the nodes compressed */
		function collapse(d) 
		{
			if (d.children) {
				d._children = d.children;
				d._children.forEach(collapse);
				d.children = null;
			}
		}
		
		addHeader();
		
	  
	d3.json("treeData.json",function(error,treeData){
		if(error) throw error;
		
		root = d3.hierarchy(treeData,function(d){
			return d.children;
		});
		
		root.each(function (d) {
                d.name = d.data.name; //transferring name to a name variable
                d.id = i; //Assigning numerical Ids
                i += i;
        });
		
		root.x0 = height / 2;
            root.y0 = 0;
			
		//root.children.forEach(collapse);
		update(root);
	});
	}
	
	
/* The below function takes care of all the Update, Entry and Exit operations that happen for each of the data */
function update(source) {

	nodes = tree(root).descendants();
	links = nodes.slice(1);
	var nodeUpdate;
    var nodeExit;
		
    //nodes.forEach(function(d) { d.y = d.depth * 150; }); // 180
    nodes.forEach(function (d) { d.y = d.depth * 110; }); // determines the depth of the tree

	nodeSvg = g.selectAll(".node")
				.data(nodes,function(d) { return d.id /*|| (d.id = ++i); -- Commented as the root name was changing*/ });
					

	var nodeEnter = nodeSvg.enter()
					.append("g")
					.attr("class", "node")
					.attr("transform", function(d) { return "translate(" + project(d.x, d.y) + ")"; })
					.on("click",click);
      
	 
	nodeEnter.append("circle")
			.attr("r", function(d){ return 5;})
			.style("fill", color)
			.append("svg:title")
				.style('position', 'absolute')
                         .style('text-align', 'center')
                         .style('opacity', 0)
                         .style('line-height', 1)
                         .style('font-weight', 'bold')
                         .style('padding', '12px')
                         .style('background', 'black')
                         .style('color', '#fff')
                         .style('border-radius', '2px')
				.text(function(d){ 
					return d.children || d._children ? "" + d.data.name : "Average Wait Time for " + d.data.name + " is " + d.data.time_2013 + " mins in the year " + selectedYear});
                         
			

    nodeEnter.append("text")
			.attr("dy", ".31em")
			.attr("fill","black")
			.attr("x", function(d) { return d.children || d._children ? -10 : 10; })
			.attr("text-anchor", function(d) { return d.children || d._children ? "start" : "end"; })
			.attr("transform",function(d) { return d.children || d._children ? ("translate(0,10)") : ("translate(0,-10)"); }) // straight to right
			.text(function(d) { return d.data.code; })
			.style("font-weight","bold");
			
			

			// Transition nodes to their new position.
		var nodeUpdate = nodeSvg.merge(nodeEnter).transition()
      .duration(duration)
	  .attr("transform", function(d) { return "translate(" + project(d.x, d.y) + ")"; });


	nodeSvg.select("circle")
      .style("fill", color);
  
  
    nodeUpdate.select("text")
      .style("fill-opacity", 1);
	

		// The existing nodes are now transitioned to the Parent's new position
	  
    var nodeExit = nodeSvg.exit().transition()
      .duration(duration)
      .attr("transform", function(d) { return "translate(" + source.y + "," + source.x + ")"; }) //for the animation to either go off there itself or come to centre
      .remove();

    nodeExit.select("circle")
      .attr("r", 1e-6);

    nodeExit.select("text")
      .style("fill-opacity", 1e-6);
	  
	nodes.forEach(function(d) {
			d.x0 = d.x;
			d.y0 = d.y;
	});
  
	
	linkSvg = g.selectAll(".link")
					.data(links, function(link) { var id = link.id + '->' + link.parent.id; return id; });
					
					
	// Transition links to their new position.
    linkSvg.transition()
           .duration(duration);
           // .attr('d', connector);
		
	// Enter any new links at the parent's previous position.
    linkEnter = linkSvg.enter().insert('path', 'g')
                    .attr("class", "link")
                    .attr("d", function (d) {
                        var o = {x: source.x0, y: source.y0, parent: {x: source.x0, y: source.y0}};
                        return connector(o);
                    })
					.style("fill",pathColor)
					.style("stroke",pathColor)
					.style("stroke-width","3px");
					
					
					
	// Transition the links to their new position.
    linkSvg.merge(linkEnter).transition()
                    .duration(duration)
                    .attr("d", connector);
					

	// Transition the exiting nodes to the parent's new position.
    linkSvg.exit().transition()
                    .duration(duration)
                    .attr("d", function (d) {
                        var o = {x: source.x, y: source.y, parent: {x: source.x, y: source.y}};
                        return connector(o);
                    })
                    .remove();
					
					
					
}

function showClock(d)
{
	
	var fileName = d.data.code + '_' + selectedYear;
	var checkValue = chosenAirports.indexOf(fileName);
	if(checkValue == -1){
		chosenAirports.push(fileName);
		readFile(d.data.code,selectedYear,fileName);
	}
	
		
	
}

/* On clicking each of the leaf node, represented by airport names, the click function is called
which in turn calls the showClock() function which displays a temporal radial visualization in the form of a clock */
function click(d) {

  if (d.children) {
    d._children = d.children;
    d.children = null;
  } else {
 
    d.children = d._children;
	if(d.children == null)
	{
	
		showClock(d);
		
	}
    d._children = null;
	
	
  }
  update(d);
}

function updateData2013()
{
	d3.selectAll("#svggroup").remove();
	selectedYear = "2013";
	for(j=0;j<chosenAirports.length;j++)
			{
				var fileName = chosenAirports[j];
				var splitData = fileName.split("_");				
				readFile(splitData[0],selectedYear,splitData[0] + "_" + selectedYear);
			}
	initialFunction();
	
	var j = 0;
	// To animate the clocks displayed for the chosen airports
			
			
	
	if(animationButtonPress == "start")
	{
	
		timeOut2013 = setTimeout(updateData2014, duration + delay);
		
	}
	else
	{
		chosenAirports = [];
	}
	
	addHeader();

}

function updateData2014()
{
	d3.selectAll("#svggroup").remove();
	selectedYear = "2014";
	var j = 0;
			for(j=0;j<chosenAirports.length;j++)
			{
				var fileName = chosenAirports[j];
				var splitData = fileName.split("_");
				//chosenAirports.every(readFile);
				readFile(splitData[0],selectedYear,splitData[0] + "_" + selectedYear);
			}
			//console.log("inside 2014");
	initialFunction();
	
	if(animationButtonPress == "start")
	{
	
		timeOut2014 = setTimeout(updateData2015, duration + delay);
	}
	else
	{
		chosenAirports = [];
	}
	
	var header = d3.select("svg");
	header = header.select("headerText");
	header.remove();
	
	d3.select(".headerText").remove();
	
	addHeader();
}

function updateData2015()
{
	d3.selectAll("#svggroup").remove();
	selectedYear = "2015";
	var j = 0;
			
			for(j=0;j<chosenAirports.length;j++)
			{
				var fileName = chosenAirports[j];
				//console.log("minuinsidebla");
				var splitData = fileName.split("_");
				//chosenAirports.every(readFile);
				readFile(splitData[0],selectedYear,splitData[0] + "_" + selectedYear);
			}
	initialFunction();
	//console.log("2015 Data");
	if(animationButtonPress == "start")
	{
	
		timeOut2015 = setTimeout(updateData2013, duration + delay);
	}
	else
	{
		chosenAirports = [];
	}
	addHeader();
}

function addHeader()
{
	d3.select(".headerText").remove();
	
	svg.append("text")
	.attr("class","headerText")
	.attr("x", 300)
    .attr("y", 50)
    .attr("dy", ".25em")
    .style("text-anchor", "middle")
	.style('background-color', 'orange')
    .text(headerFunc)
	//.attr("transform","translate(-500,10)")
	.style('line-height', 1)
	.style('font-weight', 'bold')
    .style('padding', '12px')
    .style('background', 'black')
    .style('color', '#fff')
    .style('border-radius', '2px')
	.attr("fill","black");
}


function headerFunc()
{
	if(selectedYear == "2013")
	{
		return "Average Wait Time per Hour for the Year 2013";
	}
	else if(selectedYear == "2014")
	{
		return "Average Wait Time per Hour for the Year 2014";
	}
	else if(selectedYear == "2015")
	{
		return "Average Wait Time per Hour for the Year 2015";
	}
}


var pathColorArray = ["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"];
//var pathColorArray = ["#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"];

function pathColor(d)
{
//['#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e','#e6ab02']
	if(selectedYear == "2013")
	{
		if(d.data.time_2013 >= 0 && d.data.time_2013 < 5)
		{
			return pathColorArray[0];
		}
		else if(d.data.time_2013 >= 5 && d.data.time_2013 < 10)
		{
			return pathColorArray[1];
		}
		else if(d.data.time_2013 >= 10 && d.data.time_2013 < 15)
		{
			return pathColorArray[2];
		}
		else if(d.data.time_2013 >=15 && d.data.time_2013 <20)
		{
			return pathColorArray[3];
		}
		else if(d.data.time_2013 >= 20)
		{
			return pathColorArray[4];
		}
		
	}
	else if(selectedYear == "2014")
	{
		if(d.data.time_2014 >= 0 && d.data.time_2014 < 5)
		{
			return pathColorArray[0];
		}
		else if(d.data.time_2014 >= 5 && d.data.time_2014 < 10)
		{
			return pathColorArray[1];
		}
		else if(d.data.time_2014 >= 10 && d.data.time_2014 < 15)
		{
			return pathColorArray[2];
		}
		else if(d.data.time_2014 >=15 && d.data.time_2014 <20)
		{
			return pathColorArray[3];
		}
		else if(d.data.time_2014 >= 20)
		{
			return pathColorArray[4];
		}
	}
	else
	{
		if(d.data.time_2015 >= 0 && d.data.time_2015 < 5)
		{
			return pathColorArray[0];
		}
		else if(d.data.time_2015 >= 5 && d.data.time_2015 < 10)
		{
			return pathColorArray[1];
		}
		else if(d.data.time_2015 >= 10 && d.data.time_2015 < 15)
		{
			return pathColorArray[2];
		}
		else if(d.data.time_2015 >=15 && d.data.time_2015 <20)
		{
			return pathColorArray[3];
		}
		else if(d.data.time_2015 >= 20)
		{
			return pathColorArray[4];
		}
	}
}
		
function color(d) {
  return d._children ? "#3182bd" // collapsed package 
      : d.children ? "#c6dbef" // expanded package
      : "#fd8d3c"; // leaf node 
}
	
function project(x, y) {
  var angle = (x - 90) / 180 * Math.PI, radius = y;
  return [radius * Math.cos(angle), radius * Math.sin(angle)];
}

function updateData()
{
	//console.log("Button is clicked");
	//toggleAll(root.children);
	root.children.forEach(toggleAll);
	
}

function toggleAll(d) {
	if (d.children) {
        d.children.forEach(toggleAll);
        compressNodes(d);
    }
}

function compressNodes(d) {
    if(d==root)
	{
	}
	else{
		//console.log("inside d.children");
    d._children = d.children;
    d.children = null;
    update(d);
    //simulation.restart();
	}
  	
  
}

var colorText = ["0 - 5","5 - 10","10 - 15","15 - 20","20 & Above"];
var colorScheme = ["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"];
var color = ["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"];

function createLegend()
{
	
	
	d3.select('body').append('div')
                         .attr('id', 'legendHeader')
                         .style('position', 'absolute')
                         .style('opacity', 1)
						 //.style('background-color', 'orange')
                         .text("Avg Wait Time (W) in Minutes")
						 .style("text-align","center")
                         .style('width', '300px')
                         .style("left", "480px")
                         .style("top", "70px")
                         .style('line-height', 1)
                         .style('font-weight', 'bold')
                         .style('padding', '3px')
                         .style('color', '#000')
                         .style('border-radius', '2px')
                         .on("click", function () {
                             startAnimation();
                         })
						 .on("mouseover", function(d){
							d3.select(this).style("cursor","pointer");
						 })
						 .on("mouseout", function(d){
							d3.select(this).style("cursor","default");
						 });
	
	
	
	var legend = svg.selectAll("legend")
    .data(color)
    .enter().append("g")
    .attr("id","initialLegend")
    .attr("class", "legend")
    .attr("transform", function(d, i) { return "translate(10," + i * 20  + ")"; });

    legend.append("rect")
    .attr("x", width-120)
    .attr("width", 18)
    .attr("height", 18)
    .style("fill", function(d,i){ return colorScheme[i]; })
	.attr("transform","translate(8,60)"); 

    legend.append("text")
    .attr("x", width - 100)
    .attr("y", 10)
    .attr("dy", ".25em")
	.attr("fill","black")
    .style("text-anchor", "start")
    .text(function(d,i) { return colorText[i]; })
	.attr("transform","translate(8,60)");

}
createLegend();

</script>
</body>
</html>
